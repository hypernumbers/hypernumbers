<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/home/dale/Desktop/hypernumbers/tests/system_test/outgoing_test_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%%%-----------------------------------------------------------------------------</i>
    2:<i>%%% File    : API_test_SUITE.erl</i>
    3:<i>%%% Author  : Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    4:<i>%%% Description :</i>
    5:<i>%%%</i>
    6:<i>%%% Created : 20 Oct 2007 by Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    7:<i>%%%-----------------------------------------------------------------------------</i>
    8:-<b>module</b>(outgoing_test_SUITE).
    9:
<a name="10"></a>   10:<i>%% Note: This directive should only be used in test suites.</i>
   11:-<b>compile</b>(export_all).
   12:
   13:-<b>include</b>("ct.hrl").
   14:-<b>include</b>("../../include/spriki.hrl").
   15:
   16:<i>%% Test server callback functions</i>
   17:<i>%%------------------------------------------------------------------------------</i>
   18:<i>%% Function: init_per_suite(Config) -&gt; Config</i>
   19:<i>%% Config - [tuple()]</i>
<a name="20"></a>   20:<i>%%   A list of key/value pairs, holding the test case configuration.</i>
   21:<i>%% Description: Initiation before the whole suite</i>
   22:<i>%%</i>
   23:<i>%% Note: This function is free to add any key/value pairs to the Config</i>
   24:<i>%% variable, but should NOT alter/remove any existing entries.</i>
   25:<i>%%------------------------------------------------------------------------------</i>
<a name=init_per_suite>   26:<b>init_per_suite</b></a>(Config) -&gt;
   27:    code:add_path("../../../../ebin"),
   28:    production_boot:start(),
   29:    bits:clear_db(),
<a name="30"></a>   30:    Url = "http://127.0.0.1:9000",
   31:    hn_util:post(Url++"/to1/a1?format=xml",
   32:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;=/mypage/a1&lt;/value&gt;&lt;/post&gt;","text/xml"),
   33:    hn_util:post(Url++"/to2/a1?format=xml",
   34:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;=/mypage/a2&lt;/value&gt;&lt;/post&gt;","text/xml"),
   35:    hn_util:post(Url++"/to3/a1?format=xml",
   36:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;=/mypage/a2&lt;/value&gt;&lt;/post&gt;","text/xml"),
   37:    Config.
   38:
   39:<i>%%------------------------------------------------------------------------------</i>
<a name="40"></a>   40:<i>%% Function: end_per_suite(Config) -&gt; _</i>
   41:<i>%% Config - [tuple()]</i>
   42:<i>%%   A list of key/value pairs, holding the test case configuration.</i>
   43:<i>%% Description: Cleanup after the whole suite</i>
   44:<i>%%------------------------------------------------------------------------------</i>
<a name=end_per_suite>   45:<b>end_per_suite</b></a>(_Config) -&gt;
   46:    production_boot:stop(),
   47:    ok.
   48:
   49:<i>%%------------------------------------------------------------------------------</i>
<a name="50"></a>   50:<i>%% Function: init_per_testcase(TestCase, Config) -&gt; Config</i>
   51:<i>%% Case - atom()</i>
   52:<i>%%   Name of the test case that is about to be run.</i>
   53:<i>%% Config - [tuple()]</i>
   54:<i>%%   A list of key/value pairs, holding the test case configuration.</i>
   55:<i>%%</i>
   56:<i>%% Description: Initiation before each test case</i>
   57:<i>%%</i>
   58:<i>%% Note: This function is free to add any key/value pairs to the Config</i>
   59:<i>%% variable, but should NOT alter/remove any existing entries.</i>
<a name="60"></a>   60:<i>%% Description: Initiation before each test case</i>
   61:<i>%%------------------------------------------------------------------------------</i>
<a name=init_per_testcase>   62:<b>init_per_testcase</b></a>(_TestCase, Config) -&gt;
   63:    Config.
   64:
   65:<i>%%------------------------------------------------------------------------------</i>
   66:<i>%% Function: end_per_testcase(TestCase, Config) -&gt; _</i>
   67:<i>%% Case - atom()</i>
   68:<i>%%   Name of the test case that is about to be run.</i>
   69:<i>%% Config - [tuple()]</i>
<a name="70"></a>   70:<i>%%   A list of key/value pairs, holding the test case configuration.</i>
   71:<i>%% Description: Cleanup after each test case</i>
   72:<i>%%------------------------------------------------------------------------------</i>
<a name=end_per_testcase>   73:<b>end_per_testcase</b></a>(_TestCase, _Config) -&gt;
   74:    ok.
   75:
   76:<i>%%------------------------------------------------------------------------------</i>
   77:<i>%% Function: all(Clause) -&gt; TestCases</i>
   78:<i>%% Clause - atom() - suite | doc</i>
   79:<i>%% TestCases - [Case]</i>
<a name="80"></a>   80:<i>%% Case - atom()</i>
   81:<i>%%   Name of a test case.</i>
   82:<i>%% Description: Returns a list of all test cases in this test suite</i>
   83:<i>%%------------------------------------------------------------------------------</i>
   84:
<a name=all>   85:<b>all</b></a>() -&gt;
   86:    [
   87:        test_outgoing1,
   88:        test_outgoing2,
   89:        test_outgoing3,
<a name="90"></a>   90:        test_outgoing4
   91:    ].
   92:
   93:<i>%% Test cases starts here.</i>
   94:<i>%%------------------------------------------------------------------------------</i>
<a name=test_outgoing1>   95:<b>test_outgoing1</b></a>() -&gt;    [{userdata,[{doc,"Description here"}]}].
<a name=test_outgoing1>   96:<b>test_outgoing1</b></a>(Config) when is_list(Config) -&gt;
   97:
   98:    Rtn = "http://127.0.0.1:9000\n/to1/\n1\n1\nhttp://127.0.0.1:"
   99:        ++"9000\n/mypage/\n1\n1",
<a name="100"></a>  100:
  101:    test_util:expected(lists:duplicate(3,Rtn),
  102:        [get_data("mypage/a1",{xml}),get_data("mypage/a1",{list}),
  103:         get_data("mypage/a1",{json})]).
  104:
  105:
<a name=test_outgoing2>  106:<b>test_outgoing2</b></a>() -&gt;    [{userdata,[{doc,"Description here"}]}].
<a name=test_outgoing2>  107:<b>test_outgoing2</b></a>(Config) when is_list(Config) -&gt;
  108:
  109:    Rtn = "http://127.0.0.1:9000\n/to2/\n1\n1\nhttp://127.0.0.1:"
<a name="110"></a>  110:        ++"9000\n/mypage/\n2\n1\nhttp://127.0.0.1:9000\n/to3/\n1\n"
  111:        ++"1\nhttp://127.0.0.1:9000\n/mypage/\n2\n1",
  112:
  113:    test_util:expected(lists:duplicate(3,Rtn),
  114:        [get_data("mypage/a2",{xml}),get_data("mypage/a2",{list}),
  115:         get_data("mypage/a2",{json})]).
  116:
<a name=test_outgoing3>  117:<b>test_outgoing3</b></a>() -&gt;       [{userdata,[{doc,"Description here"}]}].
<a name=test_outgoing3>  118:<b>test_outgoing3</b></a>(Config) when is_list(Config) -&gt;
  119:
<a name="120"></a>  120:    Rtn = "http://127.0.0.1:9000\n/to3/\n1\n1\nhttp://127.0.0.1:9000\n/mypage"
  121:        ++"/\n2\n1\nhttp://127.0.0.1:9000\n/to2/\n1\n1\nhttp://127.0.0.1:9000"
  122:        ++"\n/mypage/\n2\n1\nhttp://127.0.0.1:9000\n/to1/\n1\n1\nhttp://127.0"
  123:        ++".0.1:9000\n/mypage/\n1\n1",
  124:
  125:    test_util:expected(lists:duplicate(3,Rtn),
  126:        [get_data("mypage/",{xml}),get_data("mypage/",{list}),
  127:         get_data("mypage/",{json})]).
  128:
<a name=test_outgoing4>  129:<b>test_outgoing4</b></a>() -&gt;       [{userdata,[{doc,"Description here"}]}].
<a name=test_outgoing4><a name="130"></a>  130:<b>test_outgoing4</b></a>(Config) when is_list(Config) -&gt;
  131:    test_util:expected(lists:duplicate(3,"empty"),
  132:        [get_data("mypage/a3",{xml}),get_data("mypage/a3",{list}),
  133:         get_data("mypage/a3",{json})]).
  134:
<a name=get_data>  135:<b>get_data</b></a>(Cell,Format) -&gt;
  136:    FormatStr = case Format of
  137:        {list} -&gt; "list"; {xml} -&gt; "xml";
  138:        {json} -&gt; "json"; {json,nocallback} -&gt; "json&amp;nocollback" end,
  139:    Url = "http://127.0.0.1:9000/"++Cell++"?format="++FormatStr++"&amp;outgoing",
<a name="140"></a>  140:    {ok, {{_Version, 200, _ReasonPhrase}, _Headers, Body}} =
  141:        http:request(get,{Url, []}, [], []),
  142:
  143:    util2:flatten_data(Format,Body).
  144:
</pre>
<hr size=1><i>The transformation of this file (145 lines) took 0.00 seconds</i><br>
</body>
</html>
