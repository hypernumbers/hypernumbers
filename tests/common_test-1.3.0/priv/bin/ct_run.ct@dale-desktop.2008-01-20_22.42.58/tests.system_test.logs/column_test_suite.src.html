<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/home/dale/Desktop/hypernumbers/tests/system_test/column_test_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%%%-----------------------------------------------------------------------------</i>
    2:<i>%%% File    : API_test_SUITE.erl</i>
    3:<i>%%% Author  : Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    4:<i>%%% Description :</i>
    5:<i>%%%</i>
    6:<i>%%% Created : 20 Oct 2007 by Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    7:<i>%%%-----------------------------------------------------------------------------</i>
    8:-<b>module</b>(column_test_SUITE).
    9:
<a name="10"></a>   10:<i>%% Note: This directive should only be used in test suites.</i>
   11:-<b>compile</b>(export_all).
   12:
   13:-<b>include</b>("ct.hrl").
   14:-<b>include</b>("../../include/spriki.hrl").
   15:
   16:<i>%% Test server callback functions</i>
   17:<i>%%------------------------------------------------------------------------------</i>
<a name=init_per_suite>   18:<b>init_per_suite</b></a>(Config) -&gt;
   19:    code:add_path("../../../../ebin"),
<a name="20"></a>   20:    production_boot:start(),
   21:    bits:clear_db(),
   22:    Config.
   23:
<a name=end_per_suite>   24:<b>end_per_suite</b></a>(_Config) -&gt;
   25:    production_boot:stop(),
   26:    ok.
   27:
<a name=init_per_testcase>   28:<b>init_per_testcase</b></a>(_TestCase, Config) -&gt; bits:clear_db(),Config.
<a name=end_per_testcase>   29:<b>end_per_testcase</b></a>(_TestCase, _Config) -&gt; ok.
<a name="30"></a>   30:
<a name=all>   31:<b>all</b></a>() -&gt;
   32:    [column1,column2,columnlast,columnlast2].
   33:
   34:<i>%% Test cases starts here.</i>
   35:<i>%%------------------------------------------------------------------------------</i>
<a name=column1>   36:<b>column1</b></a>() -&gt;  [{userdata,[{doc,"Description here"}]}].
<a name=column1>   37:<b>column1</b></a>(Config) when is_list(Config) -&gt;
   38:   test_util:expected(lists:duplicate(3,"a\nb\n1\n2"),post_data("1",{"post",
   39:        [{"action","create"},{"value",[{"cell","a"},{"cell","b"},{"cell","1"},{"cell","2"}]}]},"")).
<a name="40"></a>   40:
<a name=column2>   41:<b>column2</b></a>() -&gt; [{userdata,[{doc,"Description here"}]}].
<a name=column2>   42:<b>column2</b></a>(Config) when is_list(Config) -&gt;
   43:    hn_util:post("http://127.0.0.1:9000/test/a1?format=xml",
   44:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;99&lt;/value&gt;&lt;/post&gt;","text/xml"),
   45:    test_util:expected(lists:duplicate(3,"10\n99\n104\nError: divide by 0"),post_data("f",{"post",
   46:        [{"action","create"},{"value",[{"cell","=5+5"},{"cell","=/test/a1"},
   47:        {"cell","=/test/a1+5"},{"cell","=4/0"}]}]},"")).
   48:
   49:
<a name=columnlast><a name="50"></a>   50:<b>columnlast</b></a>() -&gt; [{userdata,[{doc,"Description here"}]}].
<a name=columnlast>   51:<b>columnlast</b></a>(Config) when is_list(Config) -&gt;
   52:    post_data("a",{"post",[{"action","create"},{"value",[
   53:        {"cell","1"},{"cell","2"},{"cell","3"},{"cell","4"}]}]},"&amp;last"),
   54:
   55:    D = util2:flatten_data({list},hn_util:req("http://127.0.0.1:9000/a1:g10")),    
   56:    test_util:expected("1\n1\n1\n2\n2\n2\n3\n3\n3\n4\n4\n4",D).
   57:
<a name=columnlast2>   58:<b>columnlast2</b></a>() -&gt; [{userdata,[{doc,"Description here"}]}].
<a name=columnlast2>   59:<b>columnlast2</b></a>(Config) when is_list(Config) -&gt;
<a name="60"></a>   60:    hn_util:post("http://127.0.0.1:9000/a1?format=xml",
   61:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;99&lt;/value&gt;&lt;/post&gt;","text/xml"),
   62:    post_data("a",{"post",[{"action","create"},{"value",[{"cell","1"}]}]},"&amp;last"),
   63:
   64:    D = util2:flatten_data({list},hn_util:req("http://127.0.0.1:9000/a")),    
   65:    test_util:expected("99\n1\n1\n1",D).
   66:
   67:<i>%% Utilities</i>
   68:<i>%%------------------------------------------------------------------------------</i>
<a name=post_data>   69:<b>post_data</b></a>(Cell,Data,Last) -&gt;
<a name="70"></a>   70:    [post_data(Cell,Data,{list},Last),post_data(Cell,Data,{xml},Last),
   71:     post_data(Cell,Data,{json},Last)].
   72:
<a name=post_data>   73:<b>post_data</b></a>(Cell,Data,Format,Last) -&gt;
   74:
   75:    {PData,Type,FormatStr} = case Format of
   76:        {list} -&gt; {spriki:to_post(Data),"text/plain","list"};
   77:        {xml}  -&gt; {spriki:to_xml(Data), "text/xml",  "xml"};
   78:        {json} -&gt; {spriki:to_json(Data),"text/plain","json"}
   79:    end,
<a name="80"></a>   80:
   81:    Url = "http://127.0.0.1:9000/"++Cell++"?format="++FormatStr++Last,
   82:    D = hn_util:post(Url,PData,Type),
   83:
   84:    ?F("Return : ~p~n",[D]),
   85:
   86:    util2:flatten_data(Format,D).
</pre>
<hr size=1><i>The transformation of this file (87 lines) took 0.00 seconds</i><br>
</body>
</html>
