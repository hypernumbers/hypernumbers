<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/home/dale/Desktop/hypernumbers/tests/system_test/incoming_test_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%%%-----------------------------------------------------------------------------</i>
    2:<i>%%% File    : API_test_SUITE.erl</i>
    3:<i>%%% Author  : Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    4:<i>%%% Description :</i>
    5:<i>%%%</i>
    6:<i>%%% Created : 20 Oct 2007 by Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    7:<i>%%%-----------------------------------------------------------------------------</i>
    8:-<b>module</b>(incoming_test_SUITE).
    9:
<a name="10"></a>   10:<i>%% Note: This directive should only be used in test suites.</i>
   11:-<b>compile</b>(export_all).
   12:
   13:-<b>include</b>("ct.hrl").
   14:-<b>include</b>("../../include/spriki.hrl").
   15:
<a name=init_per_suite>   16:<b>init_per_suite</b></a>(Config) -&gt;
   17:    code:add_path("../../ebin"),
   18:    production_boot:start(),
   19:    bits:clear_db(),
<a name="20"></a>   20:    Url = "http://127.0.0.1:9000",
   21:    hn_util:post(Url++"/mypage/a1?format=xml",
   22:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;=/from1/a1&lt;/value&gt;&lt;/post&gt;","text/xml"),
   23:    hn_util:post(Url++"/mypage/a2?format=xml",
   24:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;=/from2/a1+/from3/a1&lt;/value&gt;&lt;/post&gt;","text/xml"),
   25:
   26:    Config.
   27:
<a name=end_per_suite>   28:<b>end_per_suite</b></a>(_Config) -&gt;
   29:    production_boot:stop(),
<a name="30"></a>   30:    ok.
   31:
<a name=init_per_testcase>   32:<b>init_per_testcase</b></a>(_TestCase, Config) -&gt;
   33:    Config.
   34:
<a name=end_per_testcase>   35:<b>end_per_testcase</b></a>(_TestCase, _Config) -&gt;
   36:    ok.
   37:
   38:
<a name=all>   39:<b>all</b></a>() -&gt;
<a name="40"></a>   40:    [
   41:        test_incoming1,
   42:        test_incoming2,
   43:        test_incoming3,
   44:        test_incoming4
   45:    ].
   46:
   47:<i>%% Test cases starts here.</i>
   48:<i>%%------------------------------------------------------------------------------</i>
<a name=test_incoming1>   49:<b>test_incoming1</b></a>() -&gt;  [{userdata,[{doc,"Set /private to be private"}]}].
<a name=test_incoming1><a name="50"></a>   50:<b>test_incoming1</b></a>(Config) when is_list(Config) -&gt;
   51:
   52:    Rtn = "http://127.0.0.1:9000\n/mypage/\n1\n1\nhttp://127.0.0.1:"
   53:        ++"9000\n/from1/\n1\n1",
   54:
   55:    test_util:expected(lists:duplicate(3,Rtn),
   56:        [get_data("mypage/a1",{xml}),get_data("mypage/a1",{list}),
   57:         get_data("mypage/a1",{json})]).
   58:
   59:
<a name=test_incoming2><a name="60"></a>   60:<b>test_incoming2</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=test_incoming2>   61:<b>test_incoming2</b></a>(Config) when is_list(Config) -&gt;
   62:
   63:    Rtn = "http://127.0.0.1:9000\n/mypage/\n2\n1\nhttp://127.0.0."
   64:        ++"1:9000\n/from3/\n1\n1\nhttp://127.0.0.1:9000\n/mypage/\n2\n1\nhttp://"
   65:        ++"127.0.0.1:9000\n/from2/\n1\n1",
   66:
   67:    test_util:expected(lists:duplicate(3,Rtn),
   68:        [get_data("mypage/a2",{xml}),get_data("mypage/a2",{list}),
   69:         get_data("mypage/a2",{json})]).
<a name="70"></a>   70:
<a name=test_incoming3>   71:<b>test_incoming3</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=test_incoming3>   72:<b>test_incoming3</b></a>(Config) when is_list(Config) -&gt;
   73:
   74:    Rtn = "http://127.0.0.1:9000\n/mypage/\n2\n1\nhttp://127.0.0.1:9000"
   75:        ++"\n/from2/\n1\n1\nhttp://127.0.0.1:9000\n/mypage/\n2\n1\nhttp://127.0.0.1:"
   76:        ++"9000\n/from3/\n1\n1\nhttp://127.0.0.1:9000\n/mypage/\n1\n1\nhttp://127.0."
   77:        ++"0.1:9000\n/from1/\n1\n1",
   78:
   79:    test_util:expected(lists:duplicate(3,Rtn),
<a name="80"></a>   80:        [get_data("mypage/",{xml}),get_data("mypage/",{list}),
   81:         get_data("mypage/",{json})]).
   82:
<a name=test_incoming4>   83:<b>test_incoming4</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=test_incoming4>   84:<b>test_incoming4</b></a>(Config) when is_list(Config) -&gt;
   85:    test_util:expected(lists:duplicate(3,"empty"),
   86:        [get_data("mypage/a3",{xml}),get_data("mypage/a3",{list}),
   87:         get_data("mypage/a3",{json})]).
   88:
<a name=get_data>   89:<b>get_data</b></a>(Cell,Format) -&gt;
<a name="90"></a>   90:    FormatStr = case Format of
   91:        {list} -&gt; "list"; {xml} -&gt; "xml";
   92:        {json} -&gt; "json"; {json,nocallback} -&gt; "json&amp;nocollback" end,
   93:    Url = "http://127.0.0.1:9000/"++Cell++"?format="++FormatStr++"&amp;incoming",
   94:    {ok, {{_Version, 200, _ReasonPhrase}, _Headers, Body}} =
   95:        http:request(get,{Url, []}, [], []),
   96:
   97:    util2:flatten_data(Format,Body).
   98:
</pre>
<hr size=1><i>The transformation of this file (99 lines) took 0.00 seconds</i><br>
</body>
</html>
