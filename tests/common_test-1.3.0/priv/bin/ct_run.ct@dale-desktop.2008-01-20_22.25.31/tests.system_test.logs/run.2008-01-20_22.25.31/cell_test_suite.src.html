<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/home/dale/Desktop/hypernumbers/tests/system_test/cell_test_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%%%-----------------------------------------------------------------------------</i>
    2:<i>%%% File    : API_test_SUITE.erl</i>
    3:<i>%%% Author  : Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    4:<i>%%% Description :</i>
    5:<i>%%%</i>
    6:<i>%%% Created : 20 Oct 2007 by Gordon Guthrie &lt;gordonguthrie@localhost&gt;</i>
    7:<i>%%%-----------------------------------------------------------------------------</i>
    8:-<b>module</b>(cell_test_SUITE).
    9:
<a name="10"></a>   10:<i>%% Note: This directive should only be used in test suites.</i>
   11:-<b>compile</b>(export_all).
   12:
   13:-<b>include</b>("ct.hrl").
   14:-<b>include</b>("../../include/spriki.hrl").
   15:
   16:<i>%% Test server callback functions</i>
   17:<i>%%------------------------------------------------------------------------------</i>
<a name=init_per_suite>   18:<b>init_per_suite</b></a>(Config) -&gt;
   19:    code:add_path("../../ebin"),
<a name="20"></a>   20:    production_boot:start(),
   21:    bits:clear_db(),
   22:    Config.
   23:
<a name=end_per_suite>   24:<b>end_per_suite</b></a>(_Config) -&gt;
   25:    production_boot:stop(),
   26:    ok.
   27:
<a name=init_per_testcase>   28:<b>init_per_testcase</b></a>(_TestCase, Config) -&gt; Config.
<a name=end_per_testcase>   29:<b>end_per_testcase</b></a>(_TestCase, _Config) -&gt; ok.
<a name="30"></a>   30:
<a name=all>   31:<b>all</b></a>() -&gt;
   32:    [cell1,cell2,cell3,cell4,cell5,cell6,cell7,cell8,cell9].
   33:
   34:<i>%% Test cases starts here.</i>
   35:<i>%%------------------------------------------------------------------------------</i>
<a name=cell1>   36:<b>cell1</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell1>   37:<b>cell1</b></a>(Config) when is_list(Config) -&gt;
   38:    test_util:expected(["abc","abc","abc"],post_data("a1",{"post",
   39:        [{"action","create"},{"value","abc"}]})).
<a name="40"></a>   40:
<a name=cell2>   41:<b>cell2</b></a>() -&gt;  [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell2>   42:<b>cell2</b></a>(Config) when is_list(Config) -&gt;
   43:    test_util:expected(["5","5","5"],post_data("a1",{"post",
   44:        [{"action","create"},{"value","5"}]})).
   45:
<a name=cell3>   46:<b>cell3</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell3>   47:<b>cell3</b></a>(Config) when is_list(Config) -&gt;
   48:    test_util:expected(["24","24","24"],post_data("a1",{"post",
   49:        [{"action","create"},{"value","=12+12"}]})).
<a name="50"></a>   50:
<a name=cell4>   51:<b>cell4</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell4>   52:<b>cell4</b></a>(Config) when is_list(Config) -&gt;
   53:    hn_util:post("http://127.0.0.1:9000/mypage/a1?format=xml",
   54:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;10&lt;/value&gt;&lt;/post&gt;","text/xml"),
   55:    test_util:expected(["10","10","10"],post_data("a1",{"post",
   56:        [{"action","create"},{"value","=/mypage/a1"}]})).
   57:
<a name=cell5>   58:<b>cell5</b></a>() -&gt;  [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell5>   59:<b>cell5</b></a>(Config) when is_list(Config) -&gt;
<a name="60"></a>   60:    test_util:expected(["24","24","24"],post_data("a1",{"post",
   61:        [{"action","create"},{"value","=12 + 12"}]})).
   62:
<a name=cell6>   63:<b>cell6</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell6>   64:<b>cell6</b></a>(Config) when is_list(Config) -&gt;
   65:    hn_util:post("http://127.0.0.1:9000/a1?format=xml",
   66:        "&lt;post&gt;&lt;action&gt;create&lt;/action&gt;&lt;value&gt;99&lt;/value&gt;&lt;/post&gt;","text/xml"),
   67:    test_util:expected(["99","99","99"],post_data("a1",{"post",
   68:        [{"action","create"},{"value","=/a1"}]})).
   69:
<a name=cell7><a name="70"></a>   70:<b>cell7</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell7>   71:<b>cell7</b></a>(Config) when is_list(Config) -&gt;
   72:    test_util:expected(["divide by 0","divide by 0","divide by 0"],
   73:        post_data("/testing/a1",{"post",[{"action","create"},{"value","=5/0"}]})).
   74:
<a name=cell8>   75:<b>cell8</b></a>() -&gt; [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell8>   76:<b>cell8</b></a>(Config) when is_list(Config) -&gt;
   77:    Url = "http://127.0.0.1:9000/a1?format=xml",
   78:    XML = "&lt;post&gt; &lt;action&gt;create&lt;/action&gt; &lt;value&gt;5&lt;/value&gt; &lt;/post&gt;",
   79:    {ok, {{_Version, 200, _ReasonPhrase}, _Headers, Body}} =
<a name="80"></a>   80:         http:request(post,{Url,[],"text/xml",XML},[],[]),
   81:    test_util:expected("5",util2:flatten_data({xml},Body)).
   82:
<a name=cell9>   83:<b>cell9</b></a>() -&gt;  [{userdata,[{doc,"Set /private to be private"}]}].
<a name=cell9>   84:<b>cell9</b></a>(Config) when is_list(Config) -&gt;
   85:    hn_util:post("http://127.0.0.1:9000/test/a1","action=create&amp;value=99"),
   86:    hn_util:post("http://127.0.0.1:9000/a1","action=create&amp;value=%3D/test/a1"),
   87:    hn_util:post("http://127.0.0.1:9000/test/a1","action=create&amp;value=50"),
   88:    test_util:expected("50",hn_util:req("http://127.0.0.1:9000/a1")).
   89:
<a name="90"></a>   90:<i>%% Utilities</i>
   91:<i>%%------------------------------------------------------------------------------</i>
<a name=post_data>   92:<b>post_data</b></a>(Cell,Data) -&gt;
   93:    [post_data(Cell,Data,{xml}),post_data(Cell,Data,{list}),
   94:     post_data(Cell,Data,{json})].
   95:
<a name=post_data>   96:<b>post_data</b></a>(Cell,Data,Format) -&gt;
   97:
   98:    {PData,Type,FormatStr} = case Format of
   99:        {list} -&gt; {spriki:to_post(Data),"text/plain","list"};
<a name="100"></a>  100:        {xml}  -&gt; {spriki:to_xml(Data), "text/xml",  "xml"};
  101:        {json} -&gt; {spriki:to_json(Data),"text/plain","json"}
  102:    end,
  103:
  104:    Url = "http://127.0.0.1:9000/"++Cell++"?format="++FormatStr,
  105:
  106:    D = hn_util:post(Url,PData,Type),
  107:
  108:    ?F("test output ~p~n",[D]),
  109:
<a name="110"></a>  110:    util2:flatten_data(Format,D).
  111:
</pre>
<hr size=1><i>The transformation of this file (112 lines) took 0.01 seconds</i><br>
</body>
</html>
