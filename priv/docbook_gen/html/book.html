<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Building Web Pages For The Hypernumbers Server</title><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="id3484886"></a>Building Web Pages For The Hypernumbers Server</h1></div><div><div class="author"><h3 class="author"><span class="firstname">Gordon</span> <span class="surname">Guthrie</span></h3></div></div><div><p class="copyright">Copyright © 2009 Hypernumbers Ltd</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#id3484876">Foreword</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id3485096">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3485093">Purpose</a></span></dt><dt><span class="sect1"><a href="#id3485139">Scope</a></span></dt><dt><span class="sect1"><a href="#id3485206">Who Is This Document <span class="emphasis"><em>Not</em></span> For</a></span></dt><dt><span class="sect1"><a href="#id3485230">Who Is This Document For</a></span></dt><dt><span class="sect1"><a href="#id3485246">Contents Of This Document</a></span></dt><dt><span class="sect1"><a href="#id3485344">Licensing</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id3485360">1. Your Development Environment</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id3485366">Overview</a></span></dt><dt><span class="sect1"><a href="#id3485410">Configuring Firefox</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3485446">Firebug</a></span></dt><dt><span class="sect2"><a href="#id3485507">JSONView</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id3485536">2. How hypernumbers GUI's Work</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id3485543">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3485580">Overview</a></span></dt><dt><span class="sect1"><a href="#id3485583">Hypernumbers' Inner Workings</a></span></dt><dt><span class="sect1"><a href="#id3485585">Hypernumbers Display API</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3485906">Introduction</a></span></dt><dt><span class="sect2"><a href="#id3485930">Attributes Information</a></span></dt><dt><span class="sect2"><a href="#id3486285">Updates Information</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id3486484">Hypernumbers POST API</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3486492">Introduction</a></span></dt><dt><span class="sect2"><a href="#id3486527">Exercise For The Reader</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id3486559">Multi-lingualisation</a></span></dt><dt><span class="sect1"><a href="#id3486573">Summary</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3486593">Introduction</a></span></dt><dt><span class="sect2"><a href="#id3486609">Developer Support</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id3486649">3. The Internals GUI</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id3486654">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3486689">Step 1 - The Blank GUI</a></span></dt><dt><span class="sect1"><a href="#id3486691">Step 2 - Building A Basic Internals GUI</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3486848">Overview</a></span></dt><dt><span class="sect2"><a href="#id3486863">Exploring The Event Cycle</a></span></dt><dt><span class="sect2"><a href="#id3486905">Building The Simple Internals GUI</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id3487005">4. Dashboard GUI</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id3487012">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3487045">Business Requirements</a></span></dt><dt><span class="sect1"><a href="#id3487077">The Spreadsheet View</a></span></dt><dt><span class="sect1"><a href="#id3487110">The HTML View</a></span></dt><dt><span class="sect1"><a href="#id3487149">The Javascript Library</a></span></dt><dt><span class="sect1"><a href="#id3487151">CSS And The Images</a></span></dt><dt><span class="sect1"><a href="#id3487296">The Dashboard In Action</a></span></dt></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>Chapter Descriptions. <a href="#id3485260"></a></dt></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="id3484876"></a>Foreword</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#id3485096">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3485093">Purpose</a></span></dt><dt><span class="sect1"><a href="#id3485139">Scope</a></span></dt><dt><span class="sect1"><a href="#id3485206">Who Is This Document <span class="emphasis"><em>Not</em></span> For</a></span></dt><dt><span class="sect1"><a href="#id3485230">Who Is This Document For</a></span></dt><dt><span class="sect1"><a href="#id3485246">Contents Of This Document</a></span></dt><dt><span class="sect1"><a href="#id3485344">Licensing</a></span></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485096"></a>Introduction</h2></div></div></div><p><span class="emphasis"><em>Building Web Pages For The Hypernumbers Server</em></span> is aimed at the average software developer who wishes to build tools for normal people to use to build hypernumbers applications.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485093"></a>Purpose</h2></div></div></div><p>The purpose of this document is to:
      </p><div class="itemizedlist"><ul type="disc"><li>explain how hypernumbers works</li><li>show some worked examples of custom GUI's</li><li>enable developers to write and deploy custom GUI's for their users</li></ul></div><p>
    </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485139"></a>Scope</h2></div></div></div><p>This document will cover the following things:
    </p><div class="itemizedlist"><ul type="disc"><li>how existing hypernumbers GUI's work</li><li>building GUI's in Javascript using the existing open source hypernumbers Javascript libraries</li><li>the main hypernumbers JSON GUI api</li></ul></div><p>
    </p><p>This document will <span class="emphasis"><em>NOT</em></span> cover the following things:
    </p><div class="itemizedlist"><ul type="disc"><li>writing server-side functions</li><li>deploying GUI's on the server</li><li>storing information under your own attributes on a hypernumber</li><li>modifying or extending the hypernumbers open source Javascript libraries</li><li>building your own GUI framework using the raw hypernumbers server JSON API</li><li>the JQuery library which hypernumbers uses 'under the covers'</li></ul></div><p>
    </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485206"></a>Who Is This Document <span class="emphasis"><em>Not</em></span> For</h2></div></div></div><p>This is <span class="emphasis"><em>not</em></span> a document for non-technical people - you need to be a programmer. If you are a basic Excel user who wants to build things with hypernumbers <span class="emphasis"><em>this is not for you</em></span>. It is a technical document.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485230"></a>Who Is This Document For</h2></div></div></div><p>This is a document for <span class="emphasis"><em>software developers</em></span> who wish to build tools for users to use with a hypernumbers server. These tools should be aimed at non-technical people - <span class="emphasis"><em>enabling them to build applications in the normal hypernumbers way</em></span>. It is aimed at the generalist and not the Javascript Guru.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485246"></a>Contents Of This Document</h2></div></div></div><table cellpadding="5" label="Chapter Descriptions" id="id3485260"><thead><tr valign="top" align="center"><td>Chapter</td><td>Description</td></tr></thead><tbody><tr valign="top"><td>Your Development Environment</td><td>explains how to set up your machine in order to develop with, and debug hypernumbers GUI's</td></tr><tr valign="top"><td>How hypernumbers GUI's Work</td><td>steps through the event cycle of the hypernumbers GUI explaining in general terms how the system is architected</td></tr><tr valign="top"><td>The Internals GUI</td><td>shows how to build a basic internals GUI that displays the internals of the update cycle. This GUI is ideal to use to learn how hypernumbers apps work by following the event cycle and seeing how updates are pushed out to the client. It also forms the basic framework for building your own GUI's</td></tr><tr valign="top"><td>The Dashboard GUI</td><td>builds the most primitive sort of GUI in a step-by-step manner - a GUI that does no updates to the server side data but just presents the information on a spreadsheet in a more appropriate manner</td></tr></tbody></table><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>More sections to follow!</div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485344"></a>Licensing</h2></div></div></div><p>This document is release under the Creative Commons License</p><p>All source code examples are available for download and are released under the Modified BSD license</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="id3485360"></a>Chapter 1. Your Development Environment</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#id3485366">Overview</a></span></dt><dt><span class="sect1"><a href="#id3485410">Configuring Firefox</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3485446">Firebug</a></span></dt><dt><span class="sect2"><a href="#id3485507">JSONView</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485366"></a>Overview</h2></div></div></div><p>This chapter will explain how to set your machine up to develop GUI's for hypernumbers. It will:
    </p><div class="itemizedlist"><ul type="disc"><li>focus on the Firefox broswer (suitable for Windows, Mac, Linux and other Unix development platforms)</li><li>show which plug-ins are most useful for hypernumbers GUI developers</li><li>provide a brief overview of Javascript debugging tools and techniques</li></ul></div><p>
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>If you are a Javascript Guru and happy with, for instance, the Safari development environment feel free to ignore this section and do yer own thang...</div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>This is not a javascript tutorial or a detailed exposition of debugging Javascript programmes.</div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485410"></a>Configuring Firefox</h2></div></div></div><p>hypernumbers needs Firefox 3 or above which can be obtained from <a class="ulink" href="http://www.mozilla.com/en-US/firefox/upgrade.html" target="_top">http://www.mozilla.com/en-US/firefox/upgrade.html</a> .</p><p>You should install the following plug-ins:
    </p><div class="itemizedlist"><ul type="disc"><li>Firebug</li><li>JSONView</li></ul></div><p>
    </p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3485446"></a>Firebug</h3></div></div></div><p>which can be installed from <a class="ulink" href="https://addons.mozilla.org/en-US/firefox/" target="_top">https://addons.mozilla.org/en-US/firefox/</a></p><p>Firebug enables you to trace hypernumbers AJAX calls and inspect the DOM to follow what is going on.</p><p>This screenshot shows us inspecting the background Ajax calls of the main hypernumbers spreadsheet GUI:</p><img src="../images/firebug1.png"><p>This screenshot shows us inspecting the DOM of the main hypernumbers spreadsheet GUI:</p><img src="../images/firebug2.png"><p>As we go on we will see these options being used to debug our application as we build it.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3485507"></a>JSONView</h3></div></div></div><p>JSONView just allows you to inspect JSON in the browser without having to save it as a file. The hypernumbers server speaks JSON exclusively so it is handy to be able to just peek at it as and when. This screenshot shows some JSON in the browser using JSONView:</p><img src="../images/jsonview.png"></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="id3485536"></a>Chapter 2. How hypernumbers GUI's Work</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#id3485543">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3485580">Overview</a></span></dt><dt><span class="sect1"><a href="#id3485583">Hypernumbers' Inner Workings</a></span></dt><dt><span class="sect1"><a href="#id3485585">Hypernumbers Display API</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3485906">Introduction</a></span></dt><dt><span class="sect2"><a href="#id3485930">Attributes Information</a></span></dt><dt><span class="sect2"><a href="#id3486285">Updates Information</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id3486484">Hypernumbers POST API</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3486492">Introduction</a></span></dt><dt><span class="sect2"><a href="#id3486527">Exercise For The Reader</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id3486559">Multi-lingualisation</a></span></dt><dt><span class="sect1"><a href="#id3486573">Summary</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3486593">Introduction</a></span></dt><dt><span class="sect2"><a href="#id3486609">Developer Support</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485543"></a>Introduction</h2></div></div></div><p>This section will:
    </p><div class="itemizedlist"><ul type="disc"><li>give an overview of how hypernumbers works</li><li>show you how to inspect the inner workings using Firebug</li><li>list the various pieces of data that the hypernumbers display API provides</li><li>a quick look at the hypernumbers POST API that allows a GUI to change the server state</li><li>multilingualisation</li></ul></div><p>
    </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485580"></a>Overview</h2></div></div></div><p>There are a number of key concepts to grasp that underpin the hypernumbers application. Hypernumbers makes a strict separation between <span class="emphasis"><em>pages</em></span> and <span class="emphasis"><em>hypernumbers</em></span> (or <span class="emphasis"><em>cells</em></span> as they appear to the end user).</p><p>It is easiest to just show this. Look at the following screenshot - notice that the URL ends in a slash - in hypernumbers this indicates a <span class="emphasis"><em>page</em></span>:</p><pre class="programlisting">
      
               http://127.0.0.1:9000/some/page/
      
    </pre><img src="../images/page.png"><p>Now lets look at cell e6 on the page. Notice that the URL for a hypernumber (or cell) ends in the cell reference:</p><pre class="programlisting">
      
               http://127.0.0.1:9000/some/page/e6
      
    </pre><img src="../images/cell1.png"><p>What appears to be a page of a spreadsheet is in fact an 'empty' page populated by lots of cells each of which has its own URL.</p><p>This is the basic operation of a hypernumbers server. The user requests a page - the hypernumbers server returns an html page with which uses Ajax calls to construct itself from a number of hypernumbers/cells. There are a number of conventions which determine which cells appear on which pages.</p><div class="itemizedlist"><ul type="disc"><li>the cells 'on' that page</li><li>the cells 'on' a page and a specific subpage</li><li>the cells 'on' the parent page</li></ul></div><p>We will see some of the design patterns later in this document</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Be sure to write examples of these design patterns prior to release of this doco, ya bas!</div><p>The basic cell URL is not so useful - it is worth expanding it with a decorator that will give us more information about the cell:</p><pre class="programlisting">
        
                 http://127.0.0.1:9000/some/page/e6?attr
        
      </pre><img src="../images/cell2.png"><p>We can use this approach to look at the attributes of cells, ranges, columns, rows and pages by using the appropriate notation for them:</p><pre class="programlisting">
        
                 http://127.0.0.1:9000/some/page/e1:f6?attr
                 http://127.0.0.1:9000/some/page/e:f?attr
                 http://127.0.0.1:9000/some/page/1:6?attr
                 http://127.0.0.1:9000/some/page/?attr
        
      </pre><p>In addition individual objects can be referred to by names instead of absolute ranges - this has a similar syntax:</p><pre class="programlisting">
      
               http://127.0.0.1:9000/some/page/@name?attr
      
    </pre><p>Getting all the attributes of a page by using a page URL plays an important part in the hypernumbers GUI building lifecycle as we will see later.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485583"></a>Hypernumbers' Inner Workings</h2></div></div></div><p>Lets use Firebug to see how the main hypernumbers GUI works. Simply (re)load a hypernumbers page and look at the Ajax traffic:</p><img src="../images/firebug1.png"><p>Firebug tells the story. Hypernumbers servers up the index page which looks like an Excel/OpenOffice spreadsheet interface. That page then makes 4 ajax requests.</p><pre class="programlisting">
      
               http://127.0.0.1:9000/some/page/?attr
               http://127.0.0.1:9000/some/page/?pages
               http://127.0.0.1:9000/some/page/?fns_en_db.json
               http://127.0.0.1:9000/some/page/?updates=1234567890
      
    </pre><p>The first of these returns all the attributes of the current page - that is to say the attributes of all cells, rows and columns on the page, as well as any particular attributes of the page itself. This data is used to build the page - putting sdasf in cell e2 and a purple centred 3434343 in cell e6, etc, etc</p><p>The second of these returns a json structure that is a tree of pages which the current logged in user has permissions to see - this is used to build the <span class="emphasis"><em>My Spreadsheets</em></span> menu.</p><p>The third of these returns the data for the functions dialog box. Notice that it is marked by language. The current language that the spreadsheet is using is stored in a cookie and the appropriate version of the GUI is sent along with the function set in the selected language.</p><p>The fourth Ajax call is mysteriously not completed. The update call is acutally a long-lived Comet connection which the server uses to update the GUI.</p><p>This fourth connection is the key to the GUI event cycle in hypernumbers. The critical point is the user action on the GUI <span class="emphasis"><em>cannot</em></span> determine what the GUI should display. It is worth understanding why that is. Consider the following set of actions:</p><pre class="programlisting">
      
               INSERT INTO CELL   =&gt; b2   VALUE  =&gt; 5
               SET FORMAT OF CELL =&gt; b3   FORMAT =&gt; "0"
               INSERT INTO CELL   =&gt; b3   VALUE  =&gt; =b2/4
      
    </pre><p>So what value should cell b3 display? The answer is that the formula calculates to 1.25 and the format which indicates how the value should be displayed says it must be rounded to the nearest integer - so the result is shown as 1.</p><p>Lets see how this plays out in hypernumbers? If we peform the actions we can see the Ajax trail shown below:</p><img src="../images/updatecycle1.png"><p>It is worth breaking out the different things that have happened:</p><img src="../images/updatecycle2.png"><p>We see the user operations appear as a series of http POST's where very simple JSON objects are posted to the cell URL's and the response of these actions is streamed over the long-lived update COMET GET's. The updates have a time parameter on them which is used for sequencing responses but has not other menaing.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>The various trail posts are a special API that enables the GUI builder to have the GUI write back a little trail of user actions to the logs</div><img src="../images/trail.png"></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3485585"></a>Hypernumbers Display API</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3485906"></a>Introduction</h3></div></div></div><p>This section will look at how hypernumbers GUI's dispaly information:</p><div class="itemizedlist"><ul type="disc"><li>attributes information</li><li>update information</li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3485930"></a>Attributes Information</h3></div></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id3485937"></a>Overview</h4></div></div></div><p>Lets look in detail at some of the information passed around in these various calls. Because Firebug doens't show off the JSON to best advantage we will just call the attributes URL in directly in the browser and examine it in JSONView. Here are all the attributes of a page copied from JSONView:</p><pre class="programlisting">
          
                   {
                   
    * time: 1247251662458203
    * user: "anonymous"
    * host: http://127.0.0.1:9000
    * viewed-tour: "true"
    * lang: "en_gb"
    *
      -
      page: {
      }
    *
      -
      styles: {
          o 5: "color:#FF00FF;font-weight:bold;text-align:center;"
          o 2: "text-align:right;"
          o 9: "font-weight:bold;text-decoration:line-through;"
          o 10: "font-weight:bold;text-decoration:line-through;text-align:right;"
          o 6: "font-weight:bold;"
          o 3: "font-weight:bold;text-align:right;"
          o 7: "font-weight:bold;text-align:left;"
          o 4: "font-weight:bold;text-align:center;"
          o 1: "text-align:left;"
          o 8: "font-weight:bold;text-decoration:line-through;text-align:left;"
      }
    *
      -
      row: {
      }
    *
      -
      column: {
      }
    *
      -
      cell: {
          o
            -
            2: {
                +
                  -
                  5: {
                      # rawvalue: "sdfasf"
                      # formula: "sdfasf"
                      # parents: "bleh"
                      # value: "sdfasf"
                      # style: 8
                      # overwrite-color: "auto"
                  }
                +
                  -
                  2: {
                      # rawvalue: 5
                      # formula: "5"
                      # parents: "bleh"
                      # value: "5"
                      # style: 10
                      # overwrite-color: "auto"
                  }
                +
                  -
                  3: {
                      # style: 9
                  }
                +
                  -
                  4: {
                      # style: 9
                  }
            }
          o
            -
            9: {
                +
                  -
                  5: {
                      # rawvalue: 3434348
                      # formula: "=sum(E6:E8)"
                      # parents: "bleh"
                      # value: "3434348"
                      # style: 2
                      # overwrite-color: "auto"
                  }
            }
          o
            -
            6: {
                +
                  -
                  5: {
                      # rawvalue: 3434343
                      # formula: "3434343"
                      # parents: "bleh"
                      # value: "3434343"
                      # style: 5
                      # overwrite-color: "auto"
                  }
            }
          o
            -
            3: {
                +
                  -
                  5: {
                      # rawvalue: "Now is the winter of our discontent"
                      # formula: "Now is the winter of our discontent"
                      # parents: "bleh"
                      # value: "Now is the winter of our discontent"
                      # style: 8
                      # overwrite-color: "auto"
                  }
                +
                  -
                  2: {
                      # rawvalue: 1.25
                      # formula: "=B2/4"
                      # parents: "bleh"
                      # value: "1"
                      # style: 10
                      # format: "0"
                      # overwrite-color: "auto"
                  }
                +
                  -
                  3: {
                      # style: 9
                  }
                +
                  -
                  4: {
                      # style: 9
                  }
            }
          o
            -
            7: {
                +
                  -
                  5: {
                      # rawvalue: 2
                      # formula: "2"
                      # parents: "bleh"
                      # value: "2"
                      # style: 2
                      # overwrite-color: "auto"
                  }
            }
          o
            -
            4: {
                +
                  -
                  5: {
                      # style: 6
                  }
                +
                  -
                  2: {
                      # style: 6
                  }
                +
                  -
                  3: {
                      # style: 6
                  }
                +
                  -
                  4: {
                      # style: 6
                  }
            }
          o
            -
            8: {
                +
                  -
                  5: {
                      # rawvalue: 3
                      # formula: "3"
                      # parents: "bleh"
                      # value: "3"
                      # style: 2
                      # overwrite-color: "auto"
                  }
            }
      }
      
}
      
        </pre><p>Reading this JSON structure top to bottom we see 6 distinct things being conveyed:</p><div class="itemizedlist"><ul type="disc"><li>general information</li><li>page attributes (here there are none)</li><li>styles</li><li>row attributes (here there are none)</li><li>column attributes (here there are none)</li><li>cell attributes</li></ul></div><p>We will discuss these 6 categories of information separately</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id3486075"></a>General Information</h4></div></div></div><p>This just stores a range of general information, who the user is, wha the host is, have they seen the tour or should it be displayed and what language the user expects</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>GUI developers <span class="emphasis"><em>cannot</em></span> define and persist their own general information to the server</div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id3486099"></a>Page Attributes</h4></div></div></div><p>hypernumbers reserves no page attributes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>GUI developers can define and persist their own page attributes and retrieve them to use in GUI's for any purpose they wish</div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id3486116"></a>Styles</h4></div></div></div><p>Hypernumbers operates a magic-style system. Various CSS attributes are recognised and may be set by the GUI. When this happens they are trapped in a magic style. Each cell has a style attribute which contains an index. That index is used to look up the style table.</p><p>The following CSS elements are in the magic style</p><div class="itemizedlist"><ul type="disc"><li>border-right-style</li><li>border-left-style</li><li>border-top-style</li><li>border-bottom-style</li><li>border-right-color</li><li>border-left-color</li><li>border-top-color</li><li>border-bottom-color</li><li>border-right-width</li><li>border-left-width</li><li>border-top-width</li><li>border-bottom-width</li><li>color</li><li>vertical-align</li><li>background-color</li><li>font-weight</li><li>font-size</li><li>font-family</li><li>font-style</li><li>font-stretch</li><li>text-decoration</li><li>text-shadow</li><li>text-align</li><li>whitespace</li></ul></div><p>Styles have page scope (which is why copy'n'paste is operated as a server-side function)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>GUI developers <span class="emphasis"><em>cannot</em></span> define and persist their own style elements</div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id3486248"></a>Row Attributes</h4></div></div></div><p>The only row attribute currently set is height.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>GUI developers are free to set their own row attributes (eg 'hidden')</div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id3486264"></a>Column Attributes</h4></div></div></div><p>The only column attribute currently set is width.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>GUI developers are free to set their own column attributes (eg 'hidden')</div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id3486281"></a>Cell Attributes</h4></div></div></div><p>The key attribute of a hypernumber/cell is the formula. This is essentially what the user types directly into the cell and it can be a range of things:</p><div class="itemizedlist"><ul type="disc"><li>a number</li><li>a string</li><li>a date</li><li>a boolean</li><li>a formula</li></ul></div><p>Numbers can be:</p><div class="itemizedlist"><ul type="disc"><li>positive</li><li>negative</li><li>integer</li><li>float</li><li>exponent</li></ul></div><p>Booleans can be:</p><div class="itemizedlist"><ul type="disc"><li>true</li><li>false</li></ul></div><p>In addition you can force a string by quoting it. Thevariants of these 6 types of entry are shown below:</p><pre class="programlisting">
            
               1
               -2
               3.45e-1
               -1.23E+1
               bob's your uncle
               and betty's "your aunt"
               true
               false
               1/2/33             =&gt; a date: displayed as 1st February 2003
               =1+2               =&gt; displays as 3
               =1+2*b3/sum(c4:c9) =&gt; displays as the result of the calculation
               '=1+2              =&gt; displays as =1+2
               '1/2/33            =&gt; displays as 1/2/33
      
          </pre><p>From this basic relationship there flows a variety of cell attributes (not all of which are exposed to the GUI) which have a complex relationship.</p><img src="../images/cellattributes.png"><p>The 'formula' attribute is evaluated resulting in the 'rawvalue'.</p><pre class="programlisting">
            
               FORMULA =&gt; 1             RAWVALUE =&gt; 1
               FORMULA =&gt; true          RAWVALUE =&gt; true
               FORMULA =&gt; hello sailor  RAWVALUE =&gt; "hello sailor"
               FORMULA =&gt; 1/2/33        RAWVALUE =&gt; 1st February 1903 00:00:00
               FORMULA =&gt; =4/5          RAWVALUE =&gt; 1.25
            
          </pre><p>The 'format' is then applied to the 'rawvalue' resulting in the 'value' and the 'overwrite-color'. The formats are compatible with Microsoft Excel 97 formats. An Excel format allows text colours to be specified depending on the value (typically red text for negative numbers, but there are other options). The 'overwrite-color' is generated from the format (if appropriate).</p><p>The various 'magic' attributes are used to construct the style. If there is no style elements associated with a cell a default style is constructed for a cell. This is typically just an alignment:</p><div class="itemizedlist"><ul type="disc"><li>numbers are aligned right</li><li>booleans are aligned centre</li><li>dates are aligned centre</li><li>strings and quoted items are aligned right</li></ul></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486285"></a>Updates Information</h3></div></div></div><p>Lets look at some typical update messages:</p><pre class="programlisting">
          
{

    * time: 1247310974071121
    *
      -
      msgs: [
          o
            -
            {
                + type: "change"
                + reftype: "cell"
                + ref: "H2"
                + name: "style"
                + value: 2
            }
      ]

}

{
    * time: 1247311089661061
    *
      _
      msgs: [

          o
            -
            {
                + type: "delete"
                + reftype: cell"
                + ref: "E2"
                + name: "rawvalue"
                + value: "sdfasf"
            }
      ]


{
    * time: 1247311470390915,
    *
      _
      msgs: [

          o
            -
            {
                + type: "style"
                + index: "11"
                + css: "background-color:#000080
                + text-align: "right;"
            }
            ]
}
            
          </pre><p>We see that they split into 2 - cell and style messages - and that the cell messages have 2 types - change and delete. This is all fairly straightforward.</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3486484"></a>Hypernumbers POST API</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486492"></a>Introduction</h3></div></div></div><p>The best way to understand the hypernumbers POST API is simply to perform some actions in a normal spreadsheet and look at the AJAX calls in Firebug:</p><pre class="programlisting">
          
                   {"set":{"font-family":"serif"}}	
                   {"set":{"mark":"Message for the logs"}}
                   {"clear":"contents"}	
                   {"copy":{"src":"http://127.0.0.1:9000/some/page/E8:E8"}}
          
        </pre><p>To understand how the POST API works it is important to look at the URL which is being posted to. Some actions are performed by POST'ing against a cell, some a range, some a column or row and some a page. On occassions the same API can be used against a combination of URL types (consult the API documentation for details).</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Write the API documentation</div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486527"></a>Exercise For The Reader</h3></div></div></div><p>The reader is invited to explore the existing hypernumbers API and understand the various post mesages. The API is largely self-explanatory.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>There are 2 post API calls which have a somewhat odd behaviour. These are 'trail' and 'mark'. 'trail' is used by a GUI designer to get the GUI to report back user behaviour (eg looking at menu items, or exploring aspects of the GUI) which the GUI designer would like to be able to monitor remotely. 'mark' is an API that simply collections a text string from the user and sends it. What both these API calls have in common is that neither touches the main hypernumbers server. They both simply write a message to the server-side logs. 'trail' messages leave a trail of the user behaviour in the logs. 'mark' messages mean that the developer can replay the server logs on a test or development machine and and then watch the users behaviour up to the point in which they feel the need to report a bug or make a comment</div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3486559"></a>Multi-lingualisation</h2></div></div></div><p>Hypernumbers GUI's are multilingual and the translation of them is done via hypernumbers pages:</p><img src="../images/multilingual.png"><p>It is good practice to build your GUI's to be multi-lingual from the start and we will see how to do that later on in this document</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3486573"></a>Summary</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486593"></a>Introduction</h3></div></div></div><p>Having now explained how the hypernumbers API's work and shown how to examine them, the next section of this document will step through building a custom GUI. Before doing that it is worth understanding hypernumbers strategy for supporting custom GUI development.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486609"></a>Developer Support</h3></div></div></div><p>The general architecture of the hypernumbers stack is shown below:</p><img src="../images/architecture.png"><p>The system has been architected with a modular design. There are large and well tested modular components (shown in white) which support the custom aspects of a particular hypernumbers deployment (the components shown in yellow). Although the hypernumbers GUI API's are pretty straightforward and a developer could build their own complete GUI on top of the raw AJAX calls it is much easier to build custom GUI's around a tested set of Javascript libraries that abstract out browser specific problems. It is this that we shall look at in the next section.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="id3486649"></a>Chapter 3. The Internals GUI</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#id3486654">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3486689">Step 1 - The Blank GUI</a></span></dt><dt><span class="sect1"><a href="#id3486691">Step 2 - Building A Basic Internals GUI</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id3486848">Overview</a></span></dt><dt><span class="sect2"><a href="#id3486863">Exploring The Event Cycle</a></span></dt><dt><span class="sect2"><a href="#id3486905">Building The Simple Internals GUI</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3486654"></a>Introduction</h2></div></div></div><p>This chapter will look at building the most basic hypernumbers GUI. Initially it will be one that simply displays a blank page but which connects to a hypernumbers server and receives all the page setup and update messages. The idea is that you can run this 'blank' GUI in one instance of Firefox pointing to a particular hypernumbers page and you can use another Firefox window and the normal spreadsheet GUI to make change to that page. Those changes (and the updates they push out can then be examined in Firebug <span class="emphasis"><em>on the blank GUI</em></span>.&gt;</p><p>The blank GUI will then be embellished to make a basic GUI that shows the update messages in a simple web page.</p><p>This technique of starting from a blank GUI to build a 'proper' hypernumbers GUI is the basis for all the other examples in this document</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3486689"></a>Step 1 - The Blank GUI</h2></div></div></div><p>Here is the HTML for the blank GUI:</p><pre class="programlisting">
      
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;

  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15"&gt;
    &lt;title&gt;hypernumbers Blank GUI&lt;/title&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
    This page left intentionally blank.
  &lt;/body&gt;

  &lt;!-- Some jquery libraries to handle AJAX calls --&gt;
  &lt;script src="/hypernumbers/jquery-1.3.1.min.js"&gt;&lt;/script&gt;
  
  &lt;!-- The basic hypernumbers javascript libaries --&gt;
  &lt;script src="/hypernumbers/hn.js"&gt;&lt;/script&gt;
  &lt;script src="/hypernumbers/hn.util.js"&gt;&lt;/script&gt;
  &lt;script src="/hypernumbers/hn.data.js"&gt;&lt;/script&gt;
  &lt;script src="/hypernumbers/hn.callbacks.js"&gt;&lt;/script&gt;
  
  &lt;!-- The custom javascript libary for this GUI --&gt;
  &lt;script src="/hypernumbers/blank_gui.js"&gt;&lt;/script&gt;
  
&lt;/html&gt;
      
    </pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>This sample has been tested in the hypernumbers docroot and not the howto one - all the javascript sources need to get a different path in the production version of this document</div><p>...and here is the Javascript:</p><pre class="programlisting">
      
// a global variable into which we will load a hypernumbers page
var loaded = {};

// A function to check if loading is complete
// this function also puts a fade-out over the page to make the page
// user-accessible only when the loading is completed
var checkloaded = function() {
  if( loaded.data ) {

    $("#path").text(document.location.pathname);
    document.title = document.location.pathname + " - hypernumbers Blank GUI";

    $("#loading, #cover").fadeOut("slow");
  }
};

// A set of options that we are going to pass into the hypernumbers page
// Notice that these are all functions which will be called on certain events
//
// Some of these events (eg dataLoaded, pagesLoaded and functionsLoaded)
// relate to setting up the page on the first time it is viewed.
//
// The others (eg dataReloaded, update, formulaError) are for when
// there are updates caused by the server-side page being updated
var options = {

  dataLoaded: function() {
    loaded.data = true;
    checkloaded();
  },

  pagesLoaded: function() {
    loaded.pages = true;
    checkloaded();
  },

  functionsLoaded: function() {
  },


  dataReloaded: function() {
  },

  update: function() {
  },

  formulaError: function(index, formula) {
  }
};

// This is where all the work happens. We declare a new HN.Data object
// and pass in 2 parameters - one describes the page to load
// and one contains the options
var data = new HN.Data(document.location.pathname, options);
      
    </pre><p>We can now use this blank GUI to look at the hypernumbers internals. Create a simple page:</p><img src="../images/blank_gui1.png"><p>...and now look at the same page with the blank gui, but this time inspecting the DOM with Firebug:</p><img src="../images/blank_gui2.png"><p>We can see that there is a global data structure that contains the following attributes:</p><div class="itemizedlist"><ul type="disc"><li>cells/hypernumbers</li><li>pages</li><li>rows</li><li>columns</li><li>styles</li></ul></div><p>If you manipulate the page using the normal gui you will see that the data object in memory on the blank GUI will update automatigically (Firebug doesn't quite keep up, you will need to close and then re-open tree elements to see the changes - but the changes do come through <span class="emphasis"><em>without reloading the page</em></span>). This is what we mean by a blank GUI showing hypernumbers internals.</p><p>The various change functions that we have seen (eg update) will be used in the next section to make the GUI no longer blank, but actually one that displays the effect of changes.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>The Blank GUI we have described in this step can be downloaded from the hypernumbers developers site.</div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3486691"></a>Step 2 - Building A Basic Internals GUI</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486848"></a>Overview</h3></div></div></div><p>This step will build on the blank_gui described in the previous section</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486863"></a>Exploring The Event Cycle</h3></div></div></div><p>To explore the event cycle for updates simply put a console log statement into the update function in the options:</p><pre class="programlisting">
        
  update: function() {
    console.log(this)
  },
        
      </pre><p>Now open two browser windows pointing the same page - one using the normal hypernumbers GUI and one using this new version of the blank GUI. When we update the normal spreadsheet we see that the callback function update is called in the blank GUI. We can repeat this process for all the other functions defined in the options and check when they are called. You will notice that update is called without <span class="emphasis"><em>any</em></span> arguments. If you look at the hypernumbers update message stream you will see that the updates come in big splurges of 5, 10, 15 or more messages. In this context it make sense to simply redaw the complete GUI everytime you get a change notification - and that's what we will do.</p><p>These functions on 'this' will give us all the information about the update that we need to control our GUI. Not all of them are needed for our simple GUI's. Lets find out which ones are...</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id3486905"></a>Building The Simple Internals GUI</h3></div></div></div><p>First things, first, lets design the new GUI. We will add a simple 5 by 5 table into the body of HTML and use the HTML id option to mark each cell.</p><pre class="programlisting">
        
  &lt;body&gt;
    &lt;p&gt;This is a basic GUI to display the internal of hypernumbers.&lt;/p&gt;
    &lt;table border="1px"&gt;
        &lt;tr&gt;
          &lt;td id="A1"&gt;a1&lt;/td&gt;
          &lt;td id="B1"&gt;b1&lt;/td&gt;
          &lt;td id="C1"&gt;c1&lt;/td&gt;
          &lt;td id="D1"&gt;d1&lt;/td&gt;
          &lt;td id="E1"&gt;e1&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td id="A2"&gt;a2&lt;/td&gt;
          &lt;td id="B2"&gt;b2&lt;/td&gt;
          &lt;td id="C2"&gt;c2&lt;/td&gt;
          &lt;td id="D2"&gt;d2&lt;/td&gt;
          &lt;td id="E2"&gt;e2&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;
          &lt;td id="A3"&gt;a3&lt;/td&gt;
          &lt;td id="B3"&gt;b3&lt;/td&gt;
          &lt;td id="C3"&gt;c3&lt;/td&gt;
          &lt;td id="D3"&gt;d3&lt;/td&gt;
          &lt;td id="E3"&gt;e3&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td id="A4"&gt;a4&lt;/td&gt;
          &lt;td id="B4"&gt;b4&lt;/td&gt;
          &lt;td id="C4"&gt;c4&lt;/td&gt;
          &lt;td id="D4"&gt;d4&lt;/td&gt;
          &lt;td id="E4"&gt;e4&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td id="A5"&gt;a5&lt;/td&gt;
          &lt;td id="B5"&gt;b5&lt;/td&gt;
          &lt;td id="C5"&gt;c5&lt;/td&gt;
          &lt;td id="D5"&gt;d5&lt;/td&gt;
          &lt;td id="E5"&gt;e5&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
  &lt;/body&gt;
        
      </pre><p>What we will now do is put a function call into the options and change the upload function as shown below:</p><pre class="programlisting">
        
  update: function() {
    draw_gui();
  },
        
      </pre><p>Finally we will draw the new GUI by creating the function draw_gui. Remember this function must be declared before it is used in update.</p><pre class="programlisting">
        
// this function will draw the GUI
var draw_gui = function() {
  console.log("in draw_gui");
  var i;
  var j;
  var id;
  var element;
  var string;
  for (i = 1; i &lt; 6; i++) {
      if (data.data.cell[i] !== undefined){
        for (j = 1; j &lt; 6; j++) {
          if (data.data.cell[i][j] !== undefined){
            id = HN.Util.to_b26(j)+i;
            element = HN.Util.id(id);
            string = "&lt;p&gt;formula: " + data.data.cell[i][j].formula + "&lt;/p&gt;";
            string = string + "&lt;p&gt;rawvalue: " + data.data.cell[i][j].rawvalue + "&lt;/p&gt;";
            string = string + "&lt;p&gt;value: " + data.data.cell[i][j].value + "&lt;/p&gt;";
            string = string + "&lt;p&gt;style: " + data.data.cell[i][j].style + "&lt;/p&gt;";
            element.innerHTML=string;
          };
        }
      }
    }
};
        
      </pre><p>This function is fairly straightforward to understand. We iterate over the top 5 by 5 set of cells, read the information out of the data variable and write them to the table cells which we address by the ID. Using the A1, B1, C1 id schema of the spreadsheet makes this very straightforward.</p><p>The next screenshot shows what this primitive Internals GUI looks like.</p><img src="../images/internals.png"></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>The Internal GUI we have described in this step can be downloaded from the hypernumbers developers site.</div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="id3487005"></a>Chapter 4. Dashboard GUI</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#id3487012">Introduction</a></span></dt><dt><span class="sect1"><a href="#id3487045">Business Requirements</a></span></dt><dt><span class="sect1"><a href="#id3487077">The Spreadsheet View</a></span></dt><dt><span class="sect1"><a href="#id3487110">The HTML View</a></span></dt><dt><span class="sect1"><a href="#id3487149">The Javascript Library</a></span></dt><dt><span class="sect1"><a href="#id3487151">CSS And The Images</a></span></dt><dt><span class="sect1"><a href="#id3487296">The Dashboard In Action</a></span></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3487012"></a>Introduction</h2></div></div></div><p>This section will describe building a simple GUI which provides a traffic light GUI Dashboard for iPhones.</p><p>It will have the following sections:</p><div class="itemizedlist"><ul type="disc"><li>the business requirements for the application</li><li>setting up the spreadsheet view</li><li>building the custom gui</li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3487045"></a>Business Requirements</h2></div></div></div><p>The business requirements for this application are:</p><div class="itemizedlist"><ul type="disc"><li>there are a series of spreadsheets to be maintained on the hypernumbers system</li><li>these spreadsheets are maintained by many different people</li><li>the results of them aggregate up to a single page which presents a dashboard for the business on an iPhone or other smart phone.</li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3487077"></a>The Spreadsheet View</h2></div></div></div><p>This is a very simple GUI. We will drive its data from a simple prescribed layout which is shown below:</p><img src="../images/dashboard1.png"><p>We will now write a GUI which will build a dashboard from this simple page. There are two data elements - the title which comes from cell E2 and the dashboard elements which are pairs of lables and indicators in columns D and E from row 5 down.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3487110"></a>The HTML View</h2></div></div></div><p>The HTML is very simply - there are only 2 elements that we are going to build. The first one is the title, and the second is the actual dashboard itself. These can be added to the basic HTML from the blank GUI&gt;</p><pre class="programlisting">
      
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;

  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15"&gt;
    &lt;title&gt;Dashboard&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" href="/hypernumbers/dashboard.css" /&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
    &lt;h1 id="title"&gt;&lt;/h1&gt;
    &lt;div id="dashboard"&gt;&lt;/div&gt;
  &lt;/body&gt;

  &lt;!-- Some jquery libraries to handle AJAX calls --&gt;
  &lt;script src="/hypernumbers/jquery-1.3.1.min.js"&gt;&lt;/script&gt;
  
  &lt;!-- The basic hypernumbers javascript libaries --&gt;
  &lt;script src="/hypernumbers/hn.js"&gt;&lt;/script&gt;
  &lt;script src="/hypernumbers/hn.util.js"&gt;&lt;/script&gt;
  &lt;script src="/hypernumbers/hn.data.js"&gt;&lt;/script&gt;
  &lt;script src="/hypernumbers/hn.callbacks.js"&gt;&lt;/script&gt;
  
  &lt;!-- The custom javascript libary for this GUI --&gt;
  &lt;script src="/hypernumbers/dashboard.js"&gt;&lt;/script&gt;
  
&lt;/html&gt;
      
    </pre><p>Note that we have added a link to a css file called 'dashboard.css' and a javascript library called 'dashboard.js' which we will create in the next step.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3487149"></a>The Javascript Library</h2></div></div></div><p>The Javascript is fairly simple. The blank GUI that we built early only redraw itself in response to change messages. This GUI needs to dispaly on first load. To make this happen we add a call to the draw_gui function from the dataloaded callback as shown below:</p><pre class="programlisting">
      
  dataLoaded: function() {
    loaded.data = true;
    draw_gui();
    checkloaded();
  },
      
    </pre><p>In order to build the dashboard we need to understand the extent of the spreadsheet - how many rows there are. Lets create a function to iterate over he data object and work that out:</p><pre class="programlisting">
      
var get_max = function() {
  var max;
  max = 5;
  for( var i in data.data.cell ) {
      if( parseInt(i) &gt; max ) {
        max = parseInt(i);
      }
  }
  return max;
};
      
    </pre><p>Now we now how big the spreadsheet it we can write the draw_gui function:</p><pre class="programlisting">
      
// this function will draw the GUI
var draw_gui = function() {
  write_title();
  write_dashboard();
};
      
    </pre><p>The function to write the title is pretty straightforward. We Know the title is in D2:</p><pre class="programlisting">
      
// this function will write the title
var write_title = function() {
  if (data.data.cell[2] &amp;&amp; data.data.cell[2][5] &amp;&amp;
      (data.data.cell[2][5].value !== undefined)) {
    var element;
    element = HN.Util.id("title");
    element.innerHTML=data.data.cell[2][5].value;
  }
};
      
    </pre><p>The function to build the dashboard is pretty straightforward as well. We will represent the dashboard as a simple table. We step over the appropriate range to build it:</p><pre class="programlisting">
      
var write_dashboard = function() {
  var i;
  var id;
  var element;
  var string;
  var max;
  // now start building the string
  string ="&lt;table&gt;";
  max = get_max();
  for (i = 5; i &lt; max + 1; i++) {
    if (data.data.cell[i] &amp;&amp; data.data.cell[i][4] &amp;&amp;
        (data.data.cell[i][4].value !== undefined)) {
      string = string + "&lt;tr&gt;&lt;td class=\"lable\"&gt;"+data.data.cell[i][4].value + "&lt;/td&gt;";
      if (data.data.cell[i][5]) {
          if (data.data.cell[i][5].value === undefined) {
            string = string + get_td("error");
          } else {
            string = string + get_td(data.data.cell[i][5].value) + "&lt;/tr&gt;";
         }
        } else {
           string = string + get_td("undefined");
         }
      }
  }
  string = string + "&lt;/table&gt;";
  element = HN.Util.id("dashboard");
  element.innerHTML=string;
};
      
    </pre><p>The lable goes in the first column of the table and we build the second column with a graphical indicator in a separate function:</p><pre class="programlisting">
      
var get_td = function(indicator) {
  switch (indicator) {
    case "red":       return "&lt;td&gt;&lt;div class=\""+indicator+"\"&gt;&lt;/td&gt;";
    case "amber":     return "&lt;td&gt;&lt;div class=\""+indicator+"\"&gt;&lt;/td&gt;";
    case "green":     return "&lt;td&gt;&lt;div class=\""+indicator+"\"&gt;&lt;/td&gt;";
    case "undefined": return "&lt;td&gt;&lt;div class=\""+indicator+"\"&gt;&lt;/td&gt;";
    case "error":     return "&lt;td&gt;&lt;div class=\""+indicator+"\"&gt;&lt;/td&gt;";
    default:          return "&lt;td&gt;&lt;div class=\"error\"&gt;&lt;/td&gt;";
  }
};
      
    </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3487151"></a>CSS And The Images</h2></div></div></div><p>The Javascript has built a table with elements with classes. The CSS file will associate the various classes to the image sprite. The image sprite is a simple strip of traffic lights and error/failure icons as shown below:</p><img src="../images/sprite.png"><p>The javascript is then pretty straightforward:</p><pre class="programlisting">
      
div.red { 
  background: url(sprite-dashboard.png) 0px 0px;
  height: 30px;
  width:  30px;
  float: left;
}

div.amber { 
  background: url(sprite-dashboard.png) -30px 0px;
  height: 30px;
  width:  30px;
  float: left;
}

div.green { 
  background: url(sprite-dashboard.png) -60px 0px;
  height: 30px;
  width:  30px;
  float: left;
}

div.error { 
  background: url(sprite-dashboard.png) -90px 0px;
  height: 30px;
  width:  30px;
  float: left;
}

div.undefined { 
  background: url(sprite-dashboard.png) -121px 0px;
  height: 30px;
  width:  29px;
  float: left;
}

td.lable { 
 width: 300px;
 font:  14px Arial, "Helvetica Neue", sans-serif;
}

h1 { 
 font:  bold 18px Arial, "Helvetica Neue", sans-serif;
}
      
    </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id3487296"></a>The Dashboard In Action</h2></div></div></div><p>The dashboard is pretty straightforward, looks alright and updates automatically:</p><img src="../images/dashboard2.png"></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>The Dashboard we have described in this step can be downloaded from the hypernumbers developers site.</div></div></div></body></html>
